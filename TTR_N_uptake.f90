!========================================================================================!
subroutine N_uptake 
!----------------------------------------------------------------------------------------!
 use TTR_parameters
 use TTR_variables
 !---------------------------------------------------------------------------------------!
 implicit none
 !---------------------------------------------------------------------------------------!

   !-------------------------------------------------------------------------------------!
   ! N uptake by the fine roots and mycorrhiza
   !-------------------------------------------------------------------------------------!
   
   !-------------------------------------------------------------------------------------!
   ! Temperature factor on soil N uptake      (unitless)
   !-------------------------------------------------------------------------------------!
   c_U_N   = c_U_N20 - (c_U_N20 - c_U_N10) * ((20.0 - T_soil) / (20.0 - 10.0))

   
   !-------------------------------------------------------------------------------------!
   ! Root activity given the soil temperature                   ([m]2 [kg X dm]-1 [d]-1)
   !-------------------------------------------------------------------------------------!
   sigma_N = sigma_N20 * T_soil


   !-------------------------------------------------------------------------------------!
   ! Effective soil N                                           ([kg N] [m]2 ground)
   !-------------------------------------------------------------------------------------!
   N_eff   = N_amm + c_U_N * N_nit


   !-------------------------------------------------------------------------------------!
   ! Uptake of soil nitrogen                                    ([kg N] [stem]-1 [d]-1)
   !-------------------------------------------------------------------------------------!
   U_N     = (M_f_X * sigma_N * N_eff) /                                                 &
             (1.0 + ((K_c_U_N / C_f) * (N_f / J_N_U_N))) 


   !-------------------------------------------------------------------------------------!
   ! Uptake of nitrate                                          ([kg N] [stem]-1 [d]-1)
   !-------------------------------------------------------------------------------------!
   U_N_nit = U_N * ((c_U_N * N_nit) / N_eff)

 
   !-------------------------------------------------------------------------------------!
   ! Uptake of ammonium                                         ([kg N] [stem]-1 [d]-1)
   !-------------------------------------------------------------------------------------!
   U_N_amm = U_N * (N_amm / N_eff)


   !-------------------------------------------------------------------------------------!
   ! Convert to uptake per timestep                             ([kg N] [stem]-1 [tsp]-1)
   !-------------------------------------------------------------------------------------!
   U_N     = U_N     * dt
   U_N_amm = U_N_amm * dt
   U_N_nit = U_N_nit * dt
   
    
!----------------------------------------------------------------------------------------!
end subroutine N_uptake
!========================================================================================!