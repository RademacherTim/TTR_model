!========================================================================================!
subroutine transport
!----------------------------------------------------------------------------------------!
 use TTR_parameters
 use TTR_variables
 !---------------------------------------------------------------------------------------!
 implicit none
 !---------------------------------------------------------------------------------------!

   !-------------------------------------------------------------------------------------!
   ! Transport fluxes (T) of C and N
   !-------------------------------------------------------------------------------------!
   ! Calculate transport coefficients
   !-------------------------------------------------------------------------------------!
   c_tau_C_l_b = c_tau_C_l_b20 * f_T_air
   c_tau_C_b_s = c_tau_C_b_s20 * f_T_air
   c_tau_C_s_c = c_tau_C_s_c20 * f_T_air
   c_tau_C_c_f = c_tau_C_c_f20 * f_T_soil
   !-------------------------------------------------------------------------------------!
   ! Calculate conductivities
   !-------------------------------------------------------------------------------------!
   g_C_l_b     = c_tau_C_l_b * (((M_l_X + M_l_M) * M_b_M) /                              &
                                 (M_l_X + M_l_M + M_b_M))
   g_C_b_s     = c_tau_C_b_s * ((M_b_M * M_s_M) /                                        &
                                (M_b_M + M_s_M))
   g_C_s_c     = c_tau_C_s_c * ((M_s_M * M_c_M) /                                        &
                                (M_s_M + M_c_M))
   g_C_c_f     = c_tau_C_c_f * ((M_c_M * (M_f_M + M_f_X)) /                              &
                                (M_c_M + M_f_M  + M_f_X))
   !write (*, '(a5, 5f15.8)') 'g    ', g_C_l_b, c_tau_C_l_b, M_l_X, M_l_M, M_b_M
   !-------------------------------------------------------------------------------------!
   ! Calculate transport fluxes
   !-------------------------------------------------------------------------------------!
   T_C_l_b     = g_C_l_b * (C_l - C_b)        ! Leaves       -> branches
   T_C_b_s     = g_C_b_s * (C_b - C_s)        ! Branches     -> stems
   T_C_s_c     = g_C_s_c * (C_s - C_c)        ! Coarse roots -> stems
   T_C_c_f     = g_C_c_f * (C_c - C_f)        ! Fine roots   -> coarse roots
   !-------------------------------------------------------------------------------------!
   !write (*, '(8f20.8)') T_C_l_b, g_C_l_b, C_l, C_b, T_N_f_c, g_N_f_c, N_f, N_c
   !write (*, '(a15, 4a12)')   '            ','T_C_l_b','T_C_b_s','T_C_s_c','T_C_c_f'
   !write (*, '(a15, 4f12.5)') 'C transport ', T_C_l_b,  T_C_b_s,  T_C_s_c,  T_C_c_f
   !write (*, *)
 
 
   !-------------------------------------------------------------------------------------! 
   ! Transport fluxes (T) of N
   !-------------------------------------------------------------------------------------!
   ! Calculate transport coefficients
   !-------------------------------------------------------------------------------------!
   c_tau_N_b_l = c_tau_N_b_l20 * f_T_air
   c_tau_N_s_b = c_tau_N_s_b20 * f_T_air
   c_tau_N_c_s = c_tau_N_c_s20 * ((f_T_soil + f_T_soil) / 2)
   c_tau_N_f_c = c_tau_N_f_c20 * f_T_soil
   !-------------------------------------------------------------------------------------!
   ! Calculate conductivities
   !-------------------------------------------------------------------------------------!
   g_N_b_l     = c_tau_N_b_l * ((M_b_M * (M_l_M + M_l_X)) /                             &
                                (M_b_M +  M_l_M + M_l_X))
   g_N_s_b     = c_tau_N_s_b * ((M_s_M * M_b_M) /                                        &
                                (M_s_M + M_b_M))
   g_N_c_s     = c_tau_N_c_s * ((M_c_M * M_s_M) /                                        &
                                (M_c_M + M_s_M))
   g_N_f_c     = c_tau_N_f_c * (((M_f_X + M_f_M) * M_c_M) /                              &
                                 (M_f_X + M_f_M  + M_c_M))
   !write (*, *) 'g    ',g_N_b_l,g_N_s_b,g_N_c_s,g_N_f_c
   !-------------------------------------------------------------------------------------!
   ! Calculate N transport fluxes
   !-------------------------------------------------------------------------------------!
   T_N_b_l     = g_N_b_l * (N_b - N_l)       ! Branches     -> leaves
   T_N_s_b     = g_N_s_b * (N_s - N_b)       ! Stems        -> branches
   T_N_c_s     = g_N_c_s * (N_c - N_s)       ! Coarse roots -> stems
   T_N_f_c     = g_N_f_c * (N_f - N_c)       ! Fine roots   -> coarse roots
   !-------------------------------------------------------------------------------------!
   !write (*, '(a15, 4a12)')   '            ','T_N_b_l','T_N_s_b','T_N_c_s','T_N_f_c'
   !write (*, '(a15, 4f12.5)') 'N transport ', T_N_b_l,  T_N_s_b,  T_N_c_s,  T_N_f_c
   !write (*, *)
   
   ! Set transport to zero - TTR
   !-------------------------------------------------------------------------------------!
   !T_C_l_b     = 0.008
   !T_C_b_s     = 0.008
   !T_C_s_c     = 0.008
   !T_C_c_f     = 0.008
   !T_N_b_l     = 0.00002
   !T_N_s_b     = 0.00002
   !T_N_c_s     = 0.00002
   !T_N_f_c     = 0.00002
   
   ! Convert to transport per timestep
   !-------------------------------------------------------------------------------------!
   T_C_l_b = T_C_l_b * dt
   T_C_b_s = T_C_b_s * dt
   T_C_s_c = T_C_s_c * dt
   T_C_c_f = T_C_c_f * dt
   T_N_b_l = T_N_b_l * dt
   T_N_s_b = T_N_s_b * dt
   T_N_c_s = T_N_c_s * dt
   T_N_f_c = T_N_f_c * dt

   
!----------------------------------------------------------------------------------------!
end subroutine transport
!========================================================================================!